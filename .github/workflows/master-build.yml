name: Master Build

on:
  push:
    branches: [ "github-build" ]

env:
  BACKEND_REPO: 'SmartBear/zephyr-enterprise-test-management-plugin'
  BACKEND_BRANCH: 'github-build'

jobs:
  build:
    name: Run Build
    runs-on: ze-test-management-plugin

    steps:
    - uses: actions/checkout@v4
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
  
    - name: Checkout BackEnd Code
      uses: actions/checkout@v2
      with:
        repository: ${{ env.BACKEND_REPO }}
        ref: ${{ env.BACKEND_BRANCH }}
        fetch-depth: 0
        
    - name: Cache Maven Packages
      uses: actions/cache@v2
      with:
        path: ~/.m2
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
        restore-keys: ${{ runner.os }}-m2     
        
    - name: Build with Maven
      run:  |
       mvn -B -f pom.xml clean package -Dmaven.test.skip=true
       mvn -v
       cat /home/runner/.m2/settings.xml
      
    - name: Copy Files to FTP Server
      shell: bash
      run: |
        scp target/zephyr-enterprise-test-management*.hpi zephyr@18.221.237.186:/share-infra/RelEng/Nightly/jenkins_integration/zephyr_jenkins_${{ env.BACKEND_BRANCH }}_${{github.run_number}}.hpi    

    
